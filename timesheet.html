<!doctype html>
<!-- Conditional comment for mobile ie7 blogs.msdn.com/b/iemobile/ -->
<!--[if IEMobile 7 ]>    <html class="no-js iem7" lang="en"> <![endif]-->
<!--[if (gt IEMobile 7)|!(IEMobile)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title> Bolt jQuery Mobile Website</title>
  <meta name="description" content="">

  <!-- Mobile viewport optimization h5bp.com/ad -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">

  <!-- Home screen icon  Mathias Bynens mathiasbynens.be/notes/touch-icons -->
  <!-- For iPhone 4 with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/h/apple-touch-icon.png">
  <!-- For first-generation iPad: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/m/apple-touch-icon.png">
  <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="img/l/apple-touch-icon-precomposed.png">
  <!-- For nokia devices: -->
  <link rel="shortcut icon" href="img/l/apple-touch-icon.png">
    
  


  <!-- iOS web app, delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
  <!-- <script>(function(){var a;if(navigator.platform==="iPad"){a=window.orientation!==90||window.orientation===-90?"img/startup-tablet-landscape.png":"img/startup-tablet-portrait.png"}else{a=window.devicePixelRatio===2?"img/startup-retina.png":"img/startup.png"}document.write('<link rel="apple-touch-startup-image" href="'+a+'"/>')})()</script> -->
  
  <!-- The script prevents links from opening in mobile safari. https://gist.github.com/1042026 -->
  <!-- <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script> -->
  
  <!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
  <!--<meta http-equiv="cleartype" content="on">-->

  <!-- more tags for your 'head' to consider h5bp.com/d/head-Tips -->
  
  
  <!-- fonts -->
  <!--<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600' rel='stylesheet' type='text/css'>-->

  
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/flexslider.css">
    
  <link rel="stylesheet" href="css/photoswipe/photoswipe.css">
  <link rel="stylesheet" href="css/jquery.mobile-1.1.1.css">
  
  <!--<link rel="stylesheet" href="css/jquery-ui-1.8.16.custom.css">-->
  
  
  <link rel="stylesheet" href="css/themes/theme-black.css">
  
  
  
  
  <!-- Main Stylesheet -->
  <!--<link rel="stylesheet" href="css/style.css">-->
  
  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-2.0.6.min.js"></script>
  <link href="css/mobiscroll.custom-2.4.3.min.css" rel="stylesheet" type="text/css" />  
  <style type="text/css">
  input[type="text"]{
      font-size:18px;
      padding: 5px;
    }
    .ui-dialog-background {
  opacity: 0.5;
  display: block !important;
  -webkit-transition: opacity 0.5s ease-in;
}
 
.ui-dialog-background.pop.in {
  opacity: 1;
  -webkit-transition: opacity 0.5s ease-in;
}
 
.ui-dialog {
  min-height: 100% !important;
  background: transparent !important;
}
  </style>
</head>
<body>
<div id="splash" class="splash"> 
  <img id="splashBg" src="img/splash.jpg" alt="Splash Image">
  <img id="splashTitle" src="img/splashTitle.png" alt="Splash Title">
</div>




  <div id="container" data-role="page" >
    <header>
    <div class="upperMenu">
        <div class="pagesMenu flexslider">
          <ul class="slides">
              <li>
                  <a href="crew.html" id="linkCrew" class="pageLink pageLink-1-1">
                    <div class="iconBox">
                      <img src="img/home/crew_icon.png" alt="crew">
                    </div>
                    <div class="titleBox">
                      Crew
                    </div>
                  </a>
              </li>
              <li>
                  <a href="tasks.html" id="linkTasks" class="pageLink pageLink-1-1" >
                    <div class="iconBox">
                      <img src="img/home/task_icon.png" alt="tasks">
                    </div>
                    <div class="titleBox">
                      Tasks
                    </div>
                  </a>
              </li>
          </ul>
      </div>
      </div>
      
      <div id="header">
        <a href="index.html" class="homeButton" data-direction="reverse"></a>
        <a href="#" class="menuButton"></a>
        <h1> Timesheet</h1>
        <h2></h2>
      </div>
    </header>

    
    <div id="pageAbout" class="page">
       <div class="content">
             <div class="groupBox innerContent" style="background:#f5f5f5;"> 
             <div class="ui-grid-a" style="width:320px;margin:0 auto;">
              <label id="hours_label">Hours</label>
        <div class="ui-block-a" id="hours_minutes" style="margin-left:-20px">
                <!-- this select must be hidden -->
                 <select id="hours" name="Hours" data-role="none" style="display:none;">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                </select>
        </div>
        
        <div class="ui-block-b">
         <label id="minutes_label">Minutes</label>
               <!-- this select must be hidden -->
                <select id="interval_time" name="Minutes" data-role="none" style="display:none;">
                    <option value="0">0</option>
                    <option value="15">15</option>
                    <option value="30">30</option>
                    <option value="45">45</option>
                </select>
            </div>
        
        </div><!-- /grid-a -->
        <label for="select_project_timesheet">Project Select</label>
              <div id="select_project_timesheet_holder"></div>
              <div style="display:none;">
                <select name="select_project_timesheet" id="select_project_timesheet">
                    //will be filled with ajax
                </select>
              </div>
              
              <label for="select_task_timesheet">Task</label>
              <div id="select_task_timesheet_holder"></div>
              <div style="display:none">
                <select name="select_task_timesheet" id="select_task_timesheet">
                    //will be filled with ajax
                </select>
              </div>
              <div data-role="fieldcontain">
                  <label for="date_scroller">Date</label>
                  <div style="width:300px;margin:0 auto;"><input name="Date" id="date_scroller"/></div>
              </div>
              <a href="#" data-role="button" id="insert_time_entry">Submit</a>
            </div>
        </div>
        <!-- end  content -->
  </div> <!--! end of #container -->


  <!-- JavaScript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>-->
  <!--<script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.min.js"><\/script>')</script>-->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>-->
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.8.2.min.js"><\/script>')</script>

  
  <!--validation for older browsers (if) -->
  
  
  <script src="js/iscroll.js"></script>
  <script src="js/jquery.flexslider-min.js"></script>
  <script src="js/photoswipe/klass.min.js"></script>
  <script src="js/photoswipe/code.photoswipe.jquery-3.0.5.min.js"></script>
  <script src="js/mobiscroll.custom-2.4.3.min.js" type="text/javascript"></script>
  <script src="cordova-2.5.0rc1.js"></script>
  <script>
    $(document).bind("mobileinit", function(){
      
          $.mobile.defaultPageTransition = 'none';
          //$.mobile.defaultPageTransition = 'slide';
          //$.mobile.defaultPageTransition = 'fade';
          //$.mobile.defaultPageTransition = 'flow';
          //$.mobile.defaultPageTransition = 'flip';
          //$.mobile.defaultPageTransition = 'pop';
          
          $.mobile.ignoreContentEnabled = true;
          
          //enable this if you want your website to run without jQuery Mobile Navigation
          $.mobile.ajaxEnabled = false;
          localStorage.removeItem("hours");
          localStorage.removeItem("minutes");
          localStorage.date=$("#date_scroller").val();
          var user =JSON.parse(localStorage.user);
          function loadTasks(AccountProjectId,itemToLoad,type){
          $itemToLoad=$(itemToLoad);
          xmlhttp= new XMLHttpRequest();
          xmlhttp.open("POST","http://krooe.com/php/getprojecttasks.php",true);
          xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
          xmlhttp.send("AccountProjectId="+AccountProjectId);
          xmlhttp.onload=function(){
              res=xmlhttp.responseText;
              res=JSON.parse(res);
              $itemToLoad.html("");
              localStorage.setItem("tasks",JSON.stringify(res));
              if(type=="list"){
                  $.each(res,function(i,obj){
                      $itemToLoad.append('<li id="'+obj.AccountProjectTaskId+'">'+obj.TaskName+'</li>');   
                  }); 
                }else{
                  $.each(res,function(i,obj){
                      $itemToLoad.append('<option value="'+obj.AccountProjectTaskId+'" id="'+obj.AccountProjectTaskIdl+'">'+obj.TaskName+'</option>');   
                  });
                }                          
              };
          }   
          //load the select list of the projects                   
          function loadProjects(itemToLoad){
              $itemToLoad=$(itemToLoad);
              var AccountId;
              //var user =localStorage.getItem("user");
              //user= JSON.parse(user);
              AccountId=user.AccountId;
              xmlhttp= new XMLHttpRequest();
              xmlhttp.open("POST","http://krooe.com/php/getproject.php",true);
              xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
              xmlhttp.send("AccountId="+AccountId);
              xmlhttp.onload=function(){
                  data=xmlhttp.responseText;
                  data=JSON.parse(data);
                  localStorage.setItem("projects",JSON.stringify(data));
                  var json= JSON.parse(localStorage.projects);
                  $itemToLoad.html("");
                  $.each(json,function(i,obj){  
                      $itemToLoad.append('<option value="'+obj.AccountProjectId+'">'+obj.ProjectName+'</option>');
                  });           
              }
          }
          loadProjects("#select_project_timesheet");
          $("#select_project_timesheet").change(function(){
              var AccountProjectId = $(this).val();
              loadTasks(AccountProjectId,"#select_task_timesheet","select");
          });
          $('#hours').mobiscroll().select({
                    theme: 'android-ics light',
                    display: 'inline',
                    mode: 'scroller',
                    inputClass: 'i-txt',
                    width: 100,
                    onChange: function(valueText, inst) {
                        localStorage.hours=$(this).val();
                    }
        }); 
        $("#hours_dummy").hide();
        $('#interval_time').mobiscroll().select({
            theme: 'android-ics light',
            display: 'inline',
            mode: 'scroller',
            inputClass: 'i-txt',
            width: 100,
            onChange: function(valueText, inst) {
                localStorage.minutes=$(this).val();
            }
        }); 
        $("#interval_time_dummy").hide();
      
        $('#select_project_timesheet').mobiscroll({
            preset:'select',
            theme: 'android-ics light',
            display: 'bottom',
            mode: 'scroller',
            inputClass: 'i-txt',
            onSelect: function(valueText, inst) {
                $("#select_project_timesheet_dummy").val($(this).find("option[value='"+$(this).val()+"']").text());
                $("#select_project_timesheet_dummy").attr("data-project-id",$(this).val());
            }
        }); 
        $("#select_project_timesheet_dummy").appendTo("#select_project_timesheet_holder");
        $("#select_project_timesheet_dummy").val("");
        $("#select_project_timesheet_dummy").attr("placeholder","Select a Project");
        $("#select_task_timesheet").mobiscroll({
            preset:'select',
            theme: 'android-ics light',
            display: 'bottom',
            mode: 'scroller',
            inputClass: 'i-txt',
            onSelect: function(valueText, inst) {
                $("#select_task_timesheet_dummy").val($(this).find("option[value='"+$(this).val()+"']").text());
                $("#select_task_timesheet_dummy").attr("data-task-id",$(this).val());
            }
        }); 
        $("#select_project_timesheet").change(function(){
              localStorage.task="";
              $("#select_task_timesheet_dummy").val("");
        });
        $("#select_task_timesheet_dummy").appendTo("#select_task_timesheet_holder");
        $("#select_task_timesheet_dummy").val("");
        $("#select_task_timesheet_dummy").attr("placeholder","Select a Task");
        $('#date_scroller').mobiscroll({
            preset: 'date',
            theme: 'android-ics light',
            display: 'inline',
            mode: 'scroller',
            dateFormat: 'dd/mm/yy',
            dateOrder: 'mmddyy',
            width:80,
            onChange: function(valueText, inst) {
                localStorage.date=$(this).val();
            }
        }); 
        $("#date_scroller").hide();
        if(typeof(localStorage.from_task)!='undefined'){
          localStorage.removeItem('from_task');
          selected_task=JSON.parse(localStorage.selected_task);
          selected_task_name=selected_task.task_name;
          $("#select_task_timesheet_dummy").val(selected_task_name);
          $("#select_task_timesheet_dummy").attr("data-task-id",selected_task.task_id);
          selected_project=JSON.parse(localStorage.selected_project);
          selected_project_name=selected_project.project_name;
          $("#select_project_timesheet_dummy").val(selected_project_name);
          $("#select_project_timesheet_dummy").attr("data-project-id",selected_project.project_id);
        }
        $("#insert_time_entry").live("click",function(){
          var can_submit =true;
          if($("#hours").val()=="0" && $("#interval_time").val()=="0"){
            can_submit=false;
          }
          if($("#select_project_timesheet_dummy").val()==""){
            can_submit=false;
          }
          if($("#select_task_timesheet_dummy").val()==""){
            can_submit=false;
          }
          if(can_submit){
            $.mobile.changePage("submit_dialog.html");
          }
        });
        $("#submit_dialog .sure-do").live("click",function() {
            xmlhttp= new XMLHttpRequest();
            xmlhttp.open("POST","http://krooe.com/php/insert_data_entry.php",true);
            //xmlhttp.open("POST","http://krooe.com/php/insert_data_entry_test.php",true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            var AccountEmployeeId=JSON.parse(localStorage.user).AccountEmployeeId;
            var AccountProjectTaskId=$("#select_task_timesheet_dummy").attr("data-task-id");
            var AccountProjectId=$("#select_project_timesheet_dummy").attr("data-project-id");
            var duration;
            var hours;
            if(typeof(localStorage.hours)=='undefined'){
              hours=0;
            }else{
              hours=parseInt(localStorage.hours);
            }
            var minutes;
            if(typeof(localStorage.minutes)=='undefined'){
              minutes=0;
            }else{
              minutes=parseInt(localStorage.minutes);
              minutes=minutes/60;
            }
            console.log("hours :",hours,"minutes :",minutes);
            var StartTime=localStorage.date;
            console.log("Start time : "+StartTime);
            duration=parseInt(hours)+parseFloat(minutes);
            console.log("Duration : "+duration);
            xmlhttp.send("AccountEmployeeId="+AccountEmployeeId+"&AccountProjectTaskId="+AccountProjectTaskId+"&AccountProjectId="+AccountProjectId
                     +"&StartTime="+StartTime+"&Hours="+duration);
            xmlhttp.onload=function(){
            res=xmlhttp.responseText;
            console.log(res);
            var json= JSON.parse(res);
            $.mobile.changePage("dialog_time_entry.html");
            if(json.message=='success'){
              localStorage.message='Time Submitted Successfully';
            }else{
              localStorage.message='Time submit failed';
            }
      }
       });
      $("#dialog_time_entry").live("pageshow",function(){
        $("#message").html(localStorage.message);
    });
      $('div[data-role="dialog"]').live('pagebeforeshow', function(e, ui) {
      ui.prevPage.addClass("ui-dialog-background ");
      });
      
        $('div[data-role="dialog"]').live('pagehide', function(e, ui) {
      $(".ui-dialog-background ").removeClass("ui-dialog-background ");
      });
        $("#hours_label").prependTo(".dwbg:eq(0)");
        $("#minutes_label").prependTo(".dwbg:eq(1)");
    });
  </script>
  <!--<script src="js/jquery.mobile-1.1.1.min.js"></script>-->
  <script src="js/jquery.mobile-1.2.0.min.js"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
  

  <!--
  <script src="js/hammer/hammer.js"></script>
  <script src="js/hammer/jquery.hammer.js"></script>
  -->
  
  <script src="js/helper.js"></script>
  <script src="js/script.js"></script>
  <!-- end scripts-->

  <!-- Debugger - remove for production -->
  <!-- <script src="https://getfirebug.com/firebug-lite.js"></script> -->

</body>
</html>